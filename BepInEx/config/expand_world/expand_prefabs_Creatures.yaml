##############################################################
# Savheim Creature AI - prefabs
##############################################################
# Prevent night time spawns in Meadows
- prefab: Goblin, SeekerBrood, Tick, Seeker, Charred_Melee, Charred_Archer, Charred_Twitcher, Charred_Mage
  type: create
  biomes: Meadows
  weight: 1E30
  remove: true

# Fix Ashlands?  (Thanks, Raaka!)
- prefab: MonsterAI
  biomes: AshLands
  type: create
  data: deaf_canswim
  fallback: true

###############################################################
# Any itemdrop created above 9000 altitude is instantly removed.  Thanks, Raaka!
# There's another version of this in Deep North code.
- prefab: ItemDrop
  type: create
  biomes: Meadows, Blackforest, Swamp, Ocean, Mountain, Plains, Mistlands, AshLands
  minY: 9000
  remove: true

###############################################################
# Special enemies don't stagger when parried
- prefab: Greydwarf_Elite, Troll, Abomination, StoneGolem, GoblinBrute, GoblinBruteBros, GoblinBrute_Hildir, SeekerBrute, Gjall, BonemawSerpent, Morgen, Charred_Archer, Surtling, Troll_Summoned
  type: create
  data: d_no_stagger
  poke:
  - self: true
    parameter: p_creature_level_up_calc_dn

###############################################################
# Serpents swim faster and don't stagger when blocked
- prefab: Serpent
  type: create
  data: d_serpent_tweaks

###############################################################
# Random clothes for creatures
# gear_buff(RandomSkillFactor)
# ... but mobs created by game don't have a RandomSkillFactor field, so would be 0.  Use "1".

# Meadows ruins use skeletons and bats.  Get them to be friendly to each other!
- prefab: Bat
  type: create
  biomes: Meadows
  data: d_meadows_ruins_bats

# keep swamp bats at level 1
- prefab: Bat
  type: create
  biomes: Swamp
  data: d_swamp_bats

- prefab: Skeleton
  type: create
  weight: 1E30
  biomes: Meadows
  data: clothes_skeleton_meadows
  poke:
  - prefab: <prefab>
    parameter: gear_buff 1
    delay: 0.1
    maxDistance: 0.1

- prefab: Skeleton
  type: create
  weight: 1E30
  biomes: Blackforest
  data: clothes_skeleton
  poke:
  - prefab: <prefab>
    parameter: gear_buff 1
    delay: 0.1
    maxDistance: 0.1

- prefab: Skeleton
  type: create
  weight: 1E30
  biomes: Swamp, Ocean, Mountain, Plains, Mistlands, AshLands, DeepNorth
  data: clothes_skeleton_icestaff
  poke:
  - prefab: <prefab>
    parameter: gear_buff 1
    delay: 0.1
    maxDistance: 0.1
  - self: true
    parameter: p_creature_level_up_calc_dn

- prefab: Skeleton_Poison
  type: create
  weight: 1E30
  data: clothes_skeleton_poison
  poke:
  - prefab: <prefab>
    parameter: gear_buff 1
    delay: 0.1
    maxDistance: 0.1
  - self: true
    parameter: p_creature_level_up_calc_dn

- prefab: Skeleton_Hildir
  type: create
  bannedObjects:
  - GoblinKing, 100
  weight: 1E30
  data: clothes_skeleton_hildir
  injectData: true    # need this in order to poke to adjust hp.  runspeed still gets applied when injected.
  poke:
  - self: true
    delay: 0.1      # delay so other data applies first
    parameter: p_dn_boss_hp_adjustments

- prefab: Draugr
  type: create
  weight: 1E30
  data: clothes_draugr
  poke:
  - prefab: <prefab>
    parameter: gear_buff 1
    delay: 0.1
    maxDistance: 0.1

- prefab: Draugr_Elite
  type: create
  weight: 1E30
  data: clothes_draugr_elite
  poke:
  - prefab: <prefab>
    parameter: gear_buff 1
    delay: 0.1
    maxDistance: 0.1
  - self: true
    parameter: p_creature_level_up_calc_dn

- prefab: Goblin
  type: create
  biomes: Blackforest, Swamp, Ocean, Mountain, Plains, Mistlands, AshLands, DeepNorth
  weight: 1E30
  data: clothes_goblin
  poke:
  - prefab: <prefab>
    parameter: gear_buff 1
    delay: 0.1
    maxDistance: 0.1
  - prefab: <prefab>
    parameter: gear_buff_goblin_spear_no_stagger
    delay: 0.2
  - self: true
    parameter: p_creature_level_up_calc_dn

- prefab: GoblinBrute
  type: create
  weight: 1E30
  data: clothes_goblin_brute
  poke:
  - prefab: <prefab>
    parameter: gear_buff 1
    delay: 0.1
    maxDistance: 0.1
  - self: true
    parameter: p_creature_level_up_calc_dn

- prefab: DvergerMage
  type: create
  weight: 1E30
  data: clothes_dverger_mage_allied_group
  injectData: true
  poke:
  - self: true
    delay: 0.1
    parameter: p_dn_mob_group_patrol

- prefab: Charred_Melee
  type: create
  biomes: Blackforest, Swamp, Ocean, Mountain, Plains, Mistlands, AshLands, DeepNorth
  weight: 1E30
  data: clothes_charred_melee
  poke:
  - prefab: <prefab>
    parameter: gear_buff 1
    delay: 0.1
    maxDistance: 0.1
  - self: true
    parameter: p_creature_level_up_calc_dn

- prefab: Charred_Mage
  type: create
  biomes: Blackforest, Swamp, Ocean, Mountain, Plains, Mistlands, AshLands, DeepNorth
  weight: 1E30
  data: clothes_charred_mage
  poke:
  - self: true
    parameter: p_creature_level_up_calc_dn

- prefab: Charred_Twitcher
  type: create
  biomes: Blackforest, Swamp, Ocean, Mountain, Plains, Mistlands, AshLands, DeepNorth
  weight: 1E30
  data: clothes_charred_twitcher

###############################################################
# Any creature with a shield has increased hp and behaves like a tank.
# HP scales with CLLC stars.
- prefab: creature
  type: poke, gear_buff
  filter: gear_shield
  data: gear_shield_buff

#############################
# Skeleton and Draugr archers don't get staggered
- prefab: creature
  type: poke, gear_buff
  filter: gear_bow
  data: d_no_stagger

- prefab: Goblin
  type: poke, gear_buff_goblin_spear_no_stagger
  filter: gear_goblin_spear
  data: d_no_stagger

#############################
# Any creature with an offhand weapon deals increased dmg and behaves like a combat rogue
# Dmg scales with CLLC stars.
- prefab: creature
  type: poke, gear_buff
  filter: gear_dual_wield
  data: gear_dw_buff

###################
# Dual wield creatures attack twice
# Enemies and summons need separate processes for the "objects" filter to ensure they're near enough a valid target.
# Clear flag to make sure only one guaranteed extra attack
- prefab: creature
  type: poke, p_dw_extra_attack_clr
  data: dw_second_attack_cd0
  injectData: true
  poke:
  - self: true
    parameter: p_dw_extra_attack

# perform second attack.  animations are gated by creature, so only those able to do "swing_longsword" will match.
- prefab: creature
  type: poke, p_dw_extra_attack
  objects:
  - Player, 2.5
  - creature, 2.5, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, attack
  - name: SetTrigger
    target: all
    1: name, swing_longsword
  - name: SetTrigger
    target: all
    1: name, attack0
  - name: SetTrigger
    target: all
    1: name, attack_thrust

# summons version - clear flag, then call summon version of extra attack
- prefab: creature
  type: poke, p_dw_extra_attack_clr_summon
  data: dw_second_attack_cd0
  injectData: true
  poke:
  - self: true
    parameter: p_dw_extra_attack_summon

# summons version - checks for enemy near enough to hit instead of {player, tame}
- prefab: creature
  type: poke, p_dw_extra_attack_summon
  objects:
  - creature, 2.5, not_tamed_creatures
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, attack
  - name: SetTrigger
    target: all
    1: name, swing_longsword
  - name: SetTrigger
    target: all
    1: name, attack0
  - name: SetTrigger
    target: all
    1: name, attack_thrust

# creature-specific attack animations and timings
- prefab: Skeleton
  type: state, attack
  filter: gear_dual_wield_cd0
  data: dw_second_attack_cd1
  injectData: true
  poke:
  - self: true
    delay: 1.5
    parameter: p_dw_extra_attack_clr

# summon versions of skeleton
- prefab: BMR_SummonSkeleton, Skeleton_Friendly
  type: state, attack
  filter: gear_dual_wield_cd0
  data: dw_second_attack_cd1
  injectData: true
  poke:
  - self: true
    delay: 1.5
    parameter: p_dw_extra_attack_clr_summon

- prefab: Draugr
  type: state, attack
  filter: gear_dual_wield_cd0
  data: dw_second_attack_cd1
  injectData: true
  poke:
  - self: true
    delay: 2
    parameter: p_dw_extra_attack_clr

- prefab: BMR_SummonDraugr
  type: state, attack
  filter: gear_dual_wield_cd0
  data: dw_second_attack_cd1
  injectData: true
  poke:
  - self: true
    delay: 2
    parameter: p_dw_extra_attack_clr_summon

- prefab: Goblin
  type: state, swing_longsword
  filter: gear_dual_wield_cd0
  data: dw_second_attack_cd1
  injectData: true
  poke:
  - self: true
    delay: 1.5
    parameter: p_dw_extra_attack_clr

- prefab: BMR_SummonGoblin
  type: state, swing_longsword
  filter: gear_dual_wield_cd0
  data: dw_second_attack_cd1
  injectData: true
  poke:
  - self: true
    delay: 1.5
    parameter: p_dw_extra_attack_clr_summon

- prefab: GoblinBrute
  type: state, attack1
  filter: gear_dual_wield_cd0
  data: dw_second_attack_cd1
  injectData: true
  poke:
  - self: true
    delay: 1.7
    parameter: p_dw_extra_attack_clr

- prefab: Charred_Melee
  types:
  - state, attack_swing
  filter: gear_dual_wield_cd0
  data: dw_second_attack_cd1
  injectData: true
  poke:
  - self: true
    delay: 1.5
    parameter: p_dw_extra_attack_clr

- prefab: BMR_SummonCharredMelee
  types:
  - state, attack_swing
  filter: gear_dual_wield_cd0
  data: dw_second_attack_cd1
  injectData: true
  poke:
  - self: true
    delay: 1.5
    parameter: p_dw_extra_attack_clr_summon

##################
# Creatures who can't dual wield, but give them a % chance for a quick follow-up attack.
# keep chances below 50%, then no need for flag to prevent infinite attacks - random instead!
# creature-specific attack animations and timings.
- prefab: Greydwarf_Elite
  type: state, attack
  weight: 0.35
  poke:
  - self: true
    delay: 1.7
    parameter: p_extra_attack

- prefab: Skeleton_Hildir
  type: state, attack
  weight: 0.45
  poke:
  - self: true
    delay: 1.8
    parameter: p_extra_attack_brenna

- prefab: Draugr_Elite
  type: state, attack
  weight: 0.4
  poke:
  - self: true
    delay: 2
    parameter: p_extra_attack

- prefab: Skeleton_Poison
  type: state, attack_mace
  weight: 0.35
  poke:
  - self: true
    delay: 2.5
    parameter: p_extra_attack

- prefab: Fenring
  types:
  - state, attack_claw0
  weight: 0.4
  poke:
  - self: true
    delay: 1.5
    parameter: p_extra_attack

- prefab: creature
  type: poke, p_extra_attack
  objects:
  - Player, 2.5
  - creature, 2.5, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, attack
  - name: SetTrigger
    target: all
    1: name, attack_mace
  - name: SetTrigger
    target: all
    1: name, attack_claw1  # this triggers brenna, hence special case below

- prefab: Skeleton_Hildir
  type: poke, p_extra_attack_brenna
  objects:
  - Player, 2.5
  - creature, 2.5, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, attack

#############################
# Any creature with an offhand elemental staff casts novas, so slow their attacks
- prefab: creature
  type: poke, gear_buff
  filter: gear_staff_ice_shards
  data: gear_staff_novas_buff

- prefab: creature
  type: poke, gear_buff
  filter: gear_staff_fireball
  data: gear_staff_novas_buff

#############################
# Any creature with a torch or lantern has increased alert range and causes character to alert other creatures
- prefab: creature
  type: poke, gear_buff
  filter: gear_alert_left
  data: gear_alert_buff

- prefab: creature
  type: poke, gear_buff
  filter: gear_alert_right
  data: gear_alert_buff

- prefab: creature
  type: state, *
  biomes: Meadows, Blackforest, Swamp, Ocean, Mountain, Plains, Mistlands, AshLands
  filter: gear_alert_left_not_tamed
  objects:
  - Player, 15
  poke:
  - self: true
    delay: 2
    parameter: p_scout_yell_loop <randf_3_6>

- prefab: creature
  type: state, *
  biomes: Meadows, Blackforest, Swamp, Ocean, Mountain, Plains, Mistlands, AshLands
  filter: gear_alert_right_not_tamed
  objects:
  - Player, 15
  poke:
  - self: true
    delay: 2
    parameter: p_scout_yell_loop <randf_3_6>

- prefab: creature
  type: poke, p_scout_yell_loop
  objects:
  - Player, 50
  spawns:
  - vfx_blocked, 0,0,1.3
  - vfx_perfectblock, 0,0,1.3
  - sfx_fallenvalkyrie_idle, 0,0,0, 0,0,0, d_sfx_scout_yell_idle
  - sfx_skeleton_big_alerted, 0,0,0, 0,0,0, d_sfx_scout_yell_screech
  poke:
  - self: true
    delay: <par1>
    parameter: p_scout_yell_loop <randf_3_6>
  - prefab: Player
    limit: 1
    maxDistance: 30
    parameter: p_player_noise
  - prefab: sfx_skeleton_big_alerted
    data: d_sfx_scout_yell_screech
    delay: 1
    limit: 1
    maxDistance: 1
    parameter: p_alert_yell_truncate

- prefab: Player
  type: poke, p_player_noise
  filter: float, noise, 0;500
  objectRpc:
  - name: RPC_AddNoise
    1: float, <float_noise>*1.5

- prefab: sfx_skeleton_big_alerted
  type: poke, p_alert_yell_truncate
  remove: true

###############################################################
# Dverger must be grouped with Dverger Mages so they don't agro the skeletons mages can summon.
- prefab: Dverger
  type: create
  weight: 1E30
  data: allied_group_data
  injectData: true
  poke:
  - self: true
    delay: 0.1
    parameter: p_dn_mob_group_patrol

# Mages with StaffSkeleton randomly summon skeleton allies.  Skeletons will die to AE.  Oh well.
- prefab: DvergerMage
  type: state, *
  filter: gear_staff_skeleton
  weight: 0.4
  triggerRules: true
  spawn: Skeleton, allied_group_data

###############################################################
# Charred Mages shield themselves on cast if they're holding a StaffShield.
# Shield only has 5 hp (skill=-39), so good for exactly one hit.  1 minute duration (level=1).
- prefab: Charred_Mage
  type: state, attack_fireaoe
  filter: gear_staff_shield
  objectRpc:
  - name: RPC_Damage
    1: hit, status=Staff_shield level=1 skill=-39
    delay: 2

###############################################################
# Skeleton with offhand StaffIceShards cast frost nova
- prefab: Skeleton
  type: state, attack
  filter: gear_staff_ice_shards
  spawns:
  - sfx_icestaff_start
  - fx_DvergerMage_Nova_ring
  poke:
  - prefab: Player, creature
    parameter: Creature_Frost_Nova
    maxDistance: 4
    delay: 0.8

# player armor reduces damage by a lot, which also reduces slow duration.
# frost resist is common on cloaks and negates slow, so add an SE to ensure slow if not dodged.
- prefab: Player
  type: poke, Creature_Frost_Nova
  spawn: vfx_dragon_ice_hit
  spawnDelay: 0.9
  objectRpc:
  - name: RPC_Damage
    1: hit, frost=<randi_123_131> dodge=true block=true status=SE_Savheim_Slowed

- prefab: creature
  type: poke, Creature_Frost_Nova
  filter: tamed_creatures
  spawn: vfx_dragon_ice_hit
  spawnDelay: 0.9
  objectRpc:
  - name: RPC_Damage
    1: hit, frost=<randi_32_36> dodge=true block=true

#################
# Summon versions
- prefab: BMR_SummonSkeleton
  type: state, attack
  filter: gear_staff_ice_shards
  spawns:
  - sfx_icestaff_start
  - fx_DvergerMage_Nova_ring
  poke:
  - prefab: creature
    parameter: Creature_Frost_Nova_Summon <randi_32_36>
    maxDistance: 4
    delay: 0.8

- prefab: Skeleton_Friendly
  type: state, attack
  filter: gear_staff_ice_shards
  spawns:
  - sfx_icestaff_start
  - fx_DvergerMage_Nova_ring
  poke:
  - prefab: creature
    parameter: Creature_Frost_Nova_Summon <randi_93_101>
    maxDistance: 4
    delay: 0.8

- prefab: creature
  type: poke, Creature_Frost_Nova_Summon
  filter: not_tamed_creatures
  spawn: vfx_dragon_ice_hit
  spawnDelay: 0.9
  objectRpc:
  - name: RPC_Damage
    1: hit, frost=<par1> dodge=true block=true

###############################################################
# Goblins with offhand StaffFireballMini cast fire nova
- prefab: Goblin
  types:
  - state, swing_longsword
  - state, spear_throw
  filter: gear_staff_fireball
  poke:
  - prefab: Player, creature
    parameter: Creature_Fire_Nova
    maxDistance: 3
    delay: 0.7

# player armor reduces damage by a lot, but players are less likely to have fire resist.
- prefab: Player
  type: poke, Creature_Fire_Nova
  spawn: fx_fireball_staff_explosion
  objectRpc:
  - name: RPC_Damage
    1: hit, fire=<randi_153_161> dodge=true block=true

- prefab: creature
  type: poke, Creature_Fire_Nova
  filter: tamed_creatures
  spawn: fx_fireball_staff_explosion
  objectRpc:
  - name: RPC_Damage
    1: hit, fire=<randi_45_49> dodge=true block=true

#################
# Summon version
- prefab: BMR_SummonGoblin
  types:
  - state, swing_longsword
  - state, spear_throw
  filter: gear_staff_fireball
  poke:
  - prefab: creature
    parameter: Creature_Fire_Nova_Summon
    maxDistance: 3
    delay: 0.7

- prefab: creature
  type: poke, Creature_Fire_Nova_Summon
  filter: not_tamed_creatures
  spawn: fx_fireball_staff_explosion
  objectRpc:
  - name: RPC_Damage
    1: hit, fire=<randi_45_49> dodge=true block=true

###############################################################
# Creatures with offhand StaffGreenRoots heal nearby creatures
- prefab: creature
  type: poke, gear_buff
  filter: gear_staffgreenroots_any
  data: gear_greenroots_buff

- prefab: Player, creature
  type: state, *
  weight: 0.1         ### low makes it occur randomly, and also prioritizes other processes
  fallback: true
  objects:
  - creature, 30, gear_staffgreenroots_any       # healer nearby?
  poke:
  - prefab: creature
    data: gear_staffgreenroots_t3
    maxDistance: 30
    limit: 1                                     # in case of multiple healers
    parameter: p_greenroots_healer_select 11+<vGreenRootsTickRnd>  ### T3 heal tick value
  - prefab: creature
    data: gear_staffgreenroots_t5
    maxDistance: 30
    limit: 1
    parameter: p_greenroots_healer_select 17+<vGreenRootsTickRnd>  ### T3 heal tick value
  - prefab: creature
    data: gear_staffgreenroots_t7
    maxDistance: 30
    limit: 1
    parameter: p_greenroots_healer_select 25+<vGreenRootsTickRnd>  ### T3 heal tick value

# select healer and set flag to put them on cooldown, then delay heal action
- prefab: creature
  type: poke, p_greenroots_healer_select
  data: d_greenroots_healer_cooldown_set
  injectData: true
  poke:
  - self: true
    delay: 3.7   ### arbitrary delay between triggering action and heal - just meant to make heal feel indepedent of action.
    parameter: p_greenroots_healer <par1>

# healer not tamed - poke untamed creatures nearby to start heal loops
- prefab: creature
  type: poke, p_greenroots_healer
  filter: not_tamed_creatures
  spawns:
  - VFX_Buff_Green, 0.5,0,1.5, 0,0,0, d_empty_data_creatures, 0.4
  - VFX_Buff_Green, -0.1,0.4,1.5, 0,0,0, d_empty_data_creatures, 0.4
  - VFX_Buff_Green, -0.2,-0.3,1.5, 0,0,0, d_empty_data_creatures, 0.4
  - fx_natureweapon_hit, 0,0,1.6, 0,0,0, d_empty_data_creatures, 0.7
  - fx_natureweapon_hit, 0,0,1.8, 0,0,0, d_empty_data_creatures, 0.8
  - fx_natureweapon_hit, 0,0,2.0, 0,0,0, d_empty_data_creatures, 0.9
  - sfx_Potion_frostresist_Start, 0,0,0, 0,0,0, greenroots_heal_pitch_1, 0.65
  - sfx_Potion_frostresist_Start, 0,0,0, 0,0,0, greenroots_heal_pitch_2, 0.8
  - sfx_Potion_frostresist_Start, 0,0,0, 0,0,0, greenroots_heal_pitch_3, 0.95
  objectRpc:
  - name: SetTrigger             # each creature will only use the animation it knows
    target: all
    1: name, attack              # skeleton
  - name: SetTrigger
    target: all
    1: name, attack_mace         # skeleton_poison
  - name: SetTrigger
    target: all
    1: name, swing_longsword     # goblin
  - name: SetTrigger
    target: all
    1: name, attack_fireaoe      # charred_mage
  poke:
  - prefab: creature
    data: not_tamed_creatures
    maxDistance: 18           ### distance from healer to be within heal range
    delay: 1
    parameter: p_greenroots_heal_loop_init <par1>
  - self: true
    delay: 10                 ### cooldown to trigger next heal
    parameter: p_greenroots_healer_cooldown_rst

# healer is tamed - poke players and tamed creatures nearby to start heal loops
- prefab: creature
  type: poke, p_greenroots_healer
  filter: tamed_creatures
  spawns:
  - VFX_Buff_Green, 0.5,0,1.5, 0,0,0, d_empty_data_creatures, 0.4
  - VFX_Buff_Green, -0.1,0.4,1.5, 0,0,0, d_empty_data_creatures, 0.4
  - VFX_Buff_Green, -0.2,-0.3,1.5, 0,0,0, d_empty_data_creatures, 0.4
  - fx_natureweapon_hit, 0,0,1.6, 0,0,0, d_empty_data_creatures, 0.7
  - fx_natureweapon_hit, 0,0,1.8, 0,0,0, d_empty_data_creatures, 0.8
  - fx_natureweapon_hit, 0,0,2.0, 0,0,0, d_empty_data_creatures, 0.9
  - sfx_Potion_frostresist_Start, 0,0,0, 0,0,0, greenroots_heal_pitch_1, 0.65
  - sfx_Potion_frostresist_Start, 0,0,0, 0,0,0, greenroots_heal_pitch_2, 0.8
  - sfx_Potion_frostresist_Start, 0,0,0, 0,0,0, greenroots_heal_pitch_3, 0.95
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, attack
  - name: SetTrigger
    target: all
    1: name, attack_mace
  - name: SetTrigger
    target: all
    1: name, swing_longsword
  - name: SetTrigger
    target: all
    1: name, attack_fireaoe
  poke:
  - prefab: Player
    maxDistance: 12           ### distance from healer to be within heal range
    delay: 1
    parameter: p_greenroots_heal_loop_init <par1>*0.3
  - prefab: creature
    data: tamed_creatures
    maxDistance: 12           ### distance from healer to be within heal range
    delay: 1
    parameter: p_greenroots_heal_loop_init <par1>*0.3
  - self: true
    delay: 10                 ### cooldown to trigger next heal
    parameter: p_greenroots_healer_cooldown_rst

- prefab: creature
  type: poke, p_greenroots_healer_cooldown_rst
  data: d_greenroots_healer_cooldown_rst
  injectData: true

# heal loop init
- prefab: Player, creature
  type: poke, p_greenroots_heal_loop_init
  filter: d_greenroots_heal_inactive             # only allow 1 loop at a time.  tick cnt must be 0 (uninitialized) or 7 (previous loop done).
  data: d_greenroots_heal_tick_cnt_rst           # reset to 1 to prevent double application
  injectData: true
  spawns:
  - VFX_Buff_Green, 0,0,1.5, 0,0,0, d_empty_data_creatures, 0.4
  - fx_natureweapon_hit, 0,0,1.75, 0,0,0, d_empty_data_creatures, 0.7
  - sfx_Potion_frostresist_Start, 0,0,0, 0,0,0, greenroots_heal_pitch_2, 0.7
  poke:
  - self: true
    delay: 1
    parameter: p_greenroots_heal_loop <par1>

# main heal loop
- prefab: Player, creature
  type: poke, p_greenroots_heal_loop
  filter: int, i_greenroots_heal_tick_cnt, 0;6   ### max 6 ticks
  data: d_greenroots_heal_tick_cnt_inc
  injectData: true
  spawns:
  - VFX_Buff_Green, 0,0,1.5, 0,0,0, d_empty_data_creatures, 0
  objectRpc:
  - name: RPC_Heal
    1: float, <par1>
    2: bool, true
    delay: 0.1
  poke:
  - self: true
    delay: 1
    parameter: p_greenroots_heal_loop <par1>

####################################################################
# SUMMONS
####################################################################
# Step 1) On spawn, poke to get to step 2, and poke any other summons to limit to one
- prefab: BMR_SummonNeck, BMR_SummonBoar, BMR_SummonGreydwarf, BMR_SummonSkeleton, BMR_SummonDraugr, BMR_SummonSurtling, BMR_SummonWolf, BMR_SummonUlv, BMR_SummonGoblin, BMR_SummonSeeker, BMR_SummonCharredMelee
  type: create
  weight: 1E30
  poke:
  - prefab: BMR_SummonNeck, BMR_SummonBoar, BMR_SummonGreydwarf, BMR_SummonSkeleton, BMR_SummonDraugr, BMR_SummonSurtling, BMR_SummonWolf, BMR_SummonUlv, BMR_SummonGoblin, BMR_SummonSeeker, BMR_SummonCharredMelee
    parameter: p_bmr_summon_tweaks <float_max_health> <float_RandomSkillFactor>
    delay: 0.1
    maxDistance: 0.1
  - prefab: BMR_SummonNeck, BMR_SummonBoar, BMR_SummonGreydwarf, BMR_SummonSkeleton, BMR_SummonDraugr, BMR_SummonSurtling, BMR_SummonWolf, BMR_SummonUlv, BMR_SummonGoblin, BMR_SummonSeeker, BMR_SummonCharredMelee, Skeleton_Friendly
    parameter: only_one_summon
    minDistance: 0.1
    maxDistance: 5

# special case for StaffSkeleton -> Skeleton_Friendly.  Base game scaling is BM (1, 50, 100) = RSF (1, 2, 3)
- prefab: Skeleton_Friendly
  type: create
  weight: 1E30
  poke:
  - prefab: Skeleton_Friendly
    parameter: p_bmr_summon_tweaks_vanilla <float_max_health> <float_RandomSkillFactor>
    delay: 0.1
    maxDistance: 0.1
  - prefab: BMR_SummonNeck, BMR_SummonBoar, BMR_SummonGreydwarf, BMR_SummonSkeleton, BMR_SummonDraugr, BMR_SummonSurtling, BMR_SummonWolf, BMR_SummonUlv, BMR_SummonGoblin, BMR_SummonSeeker, BMR_SummonCharredMelee, Skeleton_Friendly
    parameter: only_one_summon
    minDistance: 0.1
    maxDistance: 5

- prefab: BMR_SummonNeck, BMR_SummonBoar, BMR_SummonGreydwarf, BMR_SummonSkeleton, BMR_SummonDraugr, BMR_SummonSurtling, BMR_SummonWolf, BMR_SummonUlv, BMR_SummonGoblin, BMR_SummonSeeker, BMR_SummonCharredMelee, Skeleton_Friendly
  type: poke, only_one_summon
  spawn: vfx_corpse_destruction_small
  remove: true

###############################
# Step 2) Fix MagicRevamped Blood Magic scaling (it defaults to 21x damage at skill=100 - yikes!)
- prefab: BMR_SummonNeck, BMR_SummonBoar, BMR_SummonGreydwarf, BMR_SummonSkeleton, BMR_SummonDraugr, BMR_SummonSurtling, BMR_SummonWolf, BMR_SummonUlv, BMR_SummonGoblin, BMR_SummonSeeker, BMR_SummonCharredMelee
  type: poke, p_bmr_summon_tweaks
  data: d_bmr_summon_tweaks
  poke:
  - prefab: <prefab>
    parameter: p_bmr_summon_clothing
    maxDistance: 0.1

# vanilla scaling is 1x, 2x, 3x damage at BM 1, 50, 100.
- prefab: Skeleton_Friendly
  type: poke, p_bmr_summon_tweaks_vanilla
  data: d_bmr_summon_tweaks_vanilla
  poke:
  - prefab: <prefab>
    parameter: p_bmr_summon_clothing
    maxDistance: 0.1

###############################
# Step 3) Clothe and buff creatures that can be clothed
- prefab: BMR_SummonSkeleton
  type: poke, p_bmr_summon_clothing
  data: clothes_skeleton_bmr_summon
  poke:
  - prefab: <prefab>
    parameter: gear_buff <float_RandomSkillFactor>
    delay: 0.1
    maxDistance: 0.1

- prefab: Skeleton_Friendly
  type: poke, p_bmr_summon_clothing
  data: clothes_skeleton_vanilla_summon
  poke:
  - prefab: <prefab>
    parameter: gear_buff <float_RandomSkillFactor>
    delay: 0.1
    maxDistance: 0.1

- prefab: BMR_SummonDraugr
  type: poke, p_bmr_summon_clothing
  data: clothes_draugr_bmr_summon
  poke:
  - prefab: <prefab>
    parameter: gear_buff <float_RandomSkillFactor>
    delay: 0.1
    maxDistance: 0.1

- prefab: BMR_SummonGoblin
  type: poke, p_bmr_summon_clothing
  data: clothes_goblin_bmr_summon
  poke:
  - prefab: <prefab>
    parameter: gear_buff <float_RandomSkillFactor>
    delay: 0.1
    maxDistance: 0.1

- prefab: BMR_SummonCharredMelee
  type: poke, p_bmr_summon_clothing
  data: clothes_charred_melee_bmr_summon
  poke:
  - prefab: <prefab>
    parameter: gear_buff <float_RandomSkillFactor>
    delay: 0.1
    maxDistance: 0.1

###############################
# Step 4) Remove misleading message!
- prefab: fx_summon_skeleton_spawn
  type: create
  poke:
  - prefab: Player
    limit: 1
    parameter: p_summon_message_hide

- prefab: Player
  type: poke, p_summon_message_hide
  objectRpc:
  - name: Message
    target: <zdo>
    1: enum_message, 2
    2: string, 
    3: int, 0
    delay: 2.55
  - name: Message
    target: <zdo>
    1: enum_message, 2
    2: string, 
    3: int, 0
    delay: 2.575
  - name: Message
    target: <zdo>
    1: enum_message, 2
    2: string, 
    3: int, 0
    delay: 2.6
  - name: Message
    target: <zdo>
    1: enum_message, 2
    2: string, 
    3: int, 0
    delay: 2.625
  - name: Message
    target: <zdo>
    1: enum_message, 2
    2: string, 
    3: int, 0
    delay: 2.65                 ### nominal
  - name: Message
    target: <zdo>
    1: enum_message, 2
    2: string, 
    3: int, 0
    delay: 2.675
  - name: Message
    target: <zdo>
    1: enum_message, 2
    2: string, 
    3: int, 0
    delay: 2.7
  - name: Message
    target: <zdo>
    1: enum_message, 2
    2: string, 
    3: int, 0
    delay: 2.725
  - name: Message
    target: <zdo>
    1: enum_message, 2
    2: string, 
    3: int, 0
    delay: 2.75

###############################################################
# No root effect on Bosses, mini bosses, elites, flying, or swimming creatures.
- prefab: fx_RootAshlands
  type: create
  poke:
  - prefab: Eikthyr, gd_king, Bonemass, Dragon, GoblinKing, SeekerQueen, Fader, Skeleton_Hildir, Fenring_Cultist_Hildir, GoblinBruteBros, GoblinShaman_Hildir, GoblinBrute_Hildir, Charred_Melee_Dyrnwyn, FallenValkyrie, Ghost, Serpent, BonemawSerpent, Wraith, Hatchling, Bat, Deathsquito, Gjall, Volture, Troll, Abomination, StoneGolem, GoblinBrute, Morgen, Troll_Summoned
    maxDistance: 1
    limit: 1
    parameter: p_creature_root_resist

# Immune to root so long as vfx_Smoked persists (handles reapplications, since SE won't trigger fx_RootAshlands again until it falls off)
- prefab: Eikthyr, gd_king, Bonemass, Dragon, GoblinKing, SeekerQueen, Fader, Skeleton_Hildir, Fenring_Cultist_Hildir, GoblinBruteBros, GoblinShaman_Hildir, GoblinBrute_Hildir, Charred_Melee_Dyrnwyn, FallenValkyrie, Ghost, Serpent, BonemawSerpent, Wraith, Hatchling, Bat, Deathsquito, Gjall, Volture, Troll, Abomination, StoneGolem, GoblinBrute, Morgen, Troll_Summoned
  type: poke, p_creature_root_resist
  objects:
  - vfx_Smoked, 0.1
  objectRpc:
  - name: RPC_Damage
    1: hit, status=SE_Savheim_RootResist
  poke:
  - self: true
    delay: 1
    parameter: p_creature_root_resist

###############################################################
# Boss tweaks
###################################################
# Eikthyr - more aggressive.  Deep North uses different data.
- prefab: Eikthyr
  type: create
  biomes: Meadows, Blackforest, Swamp, Ocean, Mountain, Plains, Mistlands, AshLands
  data: d_eikthyr_ai

###################################################
# Elder - Tentaroots move around - creepy!  (Thanks, Raaka!)
- prefab: TentaRoot
  type: create
  filter: not_tamed_creatures
  objects:
  - gd_king, 100
  data: TentaRootMover

# Elder - Fewer Tentaroots in melee range, to make melee more viable
- prefab: TentaRoot
  type: create
  weight: 4
  filter: not_tamed_creatures
  objects:
  - gd_king, 12
  remove: true

# Elder - tentaroots slime nearby players when they attack.  (Thanks, Raaka!)
- prefab: TentaRoot
  type: state, attack
  filter: not_tamed_creatures
  poke:
  - prefab: Player
    limit: 5
    maxDistance: 4.1
    delay: 1.4
    parameter: tentarootslimed
  - prefab: creature
    data: tamed_creatures
    limit: 5
    maxDistance: 4.1
    delay: 1.4
    parameter: tentarootslimed

# Roots summoned by Staff of the Wild also get to apply Slimed.
- prefab: TentaRoot
  type: state, attack
  filter: tamed_creatures
  poke:
  - prefab: creature
    data: not_tamed_creatures
    limit: 5
    maxDistance: 4.1
    delay: 1.4
    parameter: tentarootslimed

- prefab: Player, creature
  type: poke, tentarootslimed
  objectRpc:
  - name: RPC_Damage
    1: hit, status=Slimed dodge=true block=true

# Elder - extra attacks
- prefab: gd_king
  types:
  - state, stomp0
  weight: 0.4
  poke:
  - self: true
    delay: 1.9
    parameter: p_extra_attack_elder_0

- prefab: gd_king
  types:
  - state, stomp1
  weight: 0.4
  poke:
  - self: true
    delay: 1.9
    parameter: p_extra_attack_elder_1

- prefab: gd_king
  type: poke, p_extra_attack_elder_0
  objects:
  - Player, 5
  - creature, 5, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, stomp1

- prefab: gd_king
  type: poke, p_extra_attack_elder_1
  objects:
  - Player, 5
  - creature, 5, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, stomp0

###################################################
# Bonemass - faster move and turn speed
- prefab: Bonemass
  type: create
  biomes: Meadows, Blackforest, Swamp, Ocean, Mountain, Plains, Mistlands, AshLands
  data: d_bonemass_ai

# Bonemass - extra attacks
- prefab: Bonemass
  types:
  - state, punch0
  weight: 0.4
  poke:
  - self: true
    delay: 1.9
    parameter: p_extra_attack_bonemass_0

- prefab: Bonemass
  types:
  - state, punch1
  weight: 0.4
  poke:
  - self: true
    delay: 1.9
    parameter: p_extra_attack_bonemass_1

- prefab: Bonemass
  type: poke, p_extra_attack_bonemass_0
  objects:
  - Player, 7
  - creature, 7, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, punch1

- prefab: Bonemass
  type: poke, p_extra_attack_bonemass_1
  objects:
  - Player, 7
  - creature, 7, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, punch0

# Bonemass - chance to spawn Rancid Remains when spawning others
- prefab: bonemass_throw_projectile
  type: destroy
  weight: 0.2
  spawn: Skeleton_Poison
  triggerRules: true

# Bonemass - chance to spawn Surtlings when spawning others
- prefab: bonemass_throw_projectile
  type: destroy
  weight: 0.2
  spawn: Surtling
  triggerRules: true

###
# Bonemass AOE and Spawn attacks check vertical location of players.
# Anyone trying to cheese by staying above his reach gets AOE on their heads.
# AOE spawned this way creates a loop each time it spawns on all players, tames, and pieces in range of AOE.
# When loop active and AOE present, players and pieces take damage PER LOOP.
# Portals are excluded from damage, but they'll break if everything beneath them breaks!
# Testing shows player and bonemass have equal y-coord when standing on level ground.
# Wood Ladder is just over 2 units of height.  Jumping at 100 Jump skill is about 3.  Bonemass altar skull is 7.  Bonemass is about 7.5 tall.
# Use 5 as elevation difference criteria for cheese.
# Bonemass AOE radius is about 15 units of distance.
- prefab: Bonemass
  types:
  - state, aoe
  - state, spawn
  poke:
  - prefab: Player
    maxDistance: 80                              ### PLAYER RANGE TO CHECK HEIGHT
    delay: 3
    parameter: p_bonemass_elev <y>

# calculate relative height of player - bonemass
- prefab: Player
  type: poke, p_bonemass_elev
  data: d_bonemass_ycalc
  injectData: true
  poke:
  - self: true
    delay: 1
    parameter: p_bonemass_elev_eval

# check if player too high, relative to bonemass.  spawn aoe animation and a sfx, then poke loops
# each player cheesing will trigger!  it'll get ugly fast if there's a whole group in a tree!  suckers.
- prefab: Player
  type: poke, p_bonemass_elev_eval
  filter: float, f_y_diff, 5;9999                ### RELATIVE HEIGHT CRITERIA
  spawns:
  - bonemass_aoe, 0,0,0, 0,0,0, d_empty_data, 0, true
  - sfx_Bonemass_idle
  poke:
  - self: true
    parameter: p_bonemass_elev_loop_init
  - self: true
    parameter: p_bonemass_elev_message
  - prefab: creature
    data: tamed_creatures
    maxDistance: 15                              ### RANGE FROM EACH PLAYER TO TAMES TO BE DMG'ed
    parameter: p_bonemass_elev_loop_init
  - prefab: Piece
    maxDistance: 15                              ### RANGE FROM EACH PLAYER TO PIECES TO BE DMG'ed
    parameter: p_bonemass_elev_loop_init  

# tell players they're bad!
- prefab: Player
  type: poke, p_bonemass_elev_message
  objectRpc:
  - name: Message
    target: <zdo>
    1: enum_message, Center
    2: string, <vBonemassElevQuotes>
    3: int, 0

# skip portals with a high-weight no-op.  they'll still break if all supports beneath them disappear!
- prefab: portal_wood, portal_stone
  type: poke, p_bonemass_elev_loop_init
  weight: 1E30

# need init processes per poked prefab to get independently-rolled randoms
- prefab: Player, creature, Piece
  type: poke, p_bonemass_elev_loop_init
  poke:
  - self: true
    parameter: p_bonemass_elev_loop_main <randi_40_60> <randi_1_9> <randf_2.1_2.9>  ### PLAYER TICK DMG, TAME & PIECE TICK DMG, TICK PERIOD

# main elevation cheese loop.
# keeps going despite aoe, but will stop when no longer near bonemass.
# stacks each time player caught cheesing!
# dmg applied when AOE present.
- prefab: Player, creature, Piece
  type: poke, p_bonemass_elev_loop_main
  objects:
  - Bonemass, 100
  poke:
  - self: true
    delay: <par3>
    parameter: p_bonemass_elev_loop_main <randi_40_60> <randi_1_9> <randf_2.1_2.9>  ### PLAYER TICK DMG, TAME & PIECE TICK DMG, TICK PERIOD
  - self: true
    delay: <par3>
    parameter: p_bonemass_elev_loop_dmg <par1> <par2>

# players take split poison and true damage to ensure stacking consequences.  Bonemass AOE is 100 poison.
- prefab: Player
  type: poke, p_bonemass_elev_loop_dmg
  objects:
  - bonemass_aoe, 15
  objectRpc:
  - name: RPC_Damage
    1: hit, poison=<par1> damage=<par2>

# tames take poison damage, but less than players (players have armor).  go easy on tames - they're expensive.
- prefab: creature
  type: poke, p_bonemass_elev_loop_dmg
  objects:
  - bonemass_aoe, 15
  objectRpc:
  - name: RPC_Damage
    1: hit, poison=<par2>

# pieces take split chop and pickaxe damage, and they occasionally spawn a vfx
- prefab: Piece
  type: poke, p_bonemass_elev_loop_dmg
  objects:
  - bonemass_aoe, 15
  objectRpc:
  - name: RPC_Damage
    1: hit, chop=<par2> pickaxe=<par2>
  poke:
  - self: true
    parameter: p_bonemass_piece_vfx

- prefab: Piece
  type: poke, p_bonemass_piece_vfx
  weight: 0.05
  spawns:
  - vfx_poisonarrow_hit
  - sfx_wood_destroyed, 0,0,0, 0,0,0, d_wood_destroyed_pitch

###
# Bonemass AOE procs Slimed so it's a tad(pole?) less ignoreable.
- prefab: bonemass_aoe
  type: create
  objects:
  - Bonemass, 100
  poke:
  - self: true
    delay: 3                                     # DELAYED STARTUP, so players can clear out
    parameter: p_bonemass_aoe_slimed_loop

- prefab: bonemass_aoe
  type: poke, p_bonemass_aoe_slimed_loop
  poke:
  - self: true
    delay: 1                                     ### SLIMED PROC PERIOD
    parameter: p_bonemass_aoe_slimed_loop
  - prefab: Player
    maxDistance: 15
    parameter: p_bonemass_aoe_slimed_se

- prefab: Player
  type: poke, p_bonemass_aoe_slimed_se
  objectRpc:
  - name: RPC_AddStatusEffect
    1: hash, Slimed
    2: bool, true
    3: int, 1
    4: float, 1

###################################################
# Moder - faster movement when grounded
- prefab: Dragon
  type: create
  biomes: Meadows, Blackforest, Swamp, Ocean, Mountain, Plains, Mistlands, AshLands
  data: d_moder_ai

# Moder - Ice Blocks have a chance to spawn an Ulv if not destroyed.  more players makes them pop sooner.
# 1 player present, so slowest ulv spawning
- prefab: IceBlocker
  type: create
  objects:
  - Dragon, 100
  - Player, 100
  objectsLimit: 2
  bannedObjects:
  - Player, 100
  bannedObjectsLimit: 2
  poke:
  - self: true
    delay: 4                                     ### time until IceBlockers can start popping Ulvs
    parameter: p_iceblock_spawn_ulv_loop 2.3     ### time between chances to pop ulvs

# 2 players present
- prefab: IceBlocker
  type: create
  objects:
  - Dragon, 100
  - Player, 100
  objectsLimit: 3
  bannedObjects:
  - Player, 100
  bannedObjectsLimit: 3
  poke:
  - self: true
    delay: 3                                     ### time until IceBlockers can start popping Ulvs
    parameter: p_iceblock_spawn_ulv_loop 1.8     ### time between chances to pop ulvs

# 3 players present
- prefab: IceBlocker
  type: create
  objects:
  - Dragon, 100
  - Player, 100
  objectsLimit: 4
  bannedObjects:
  - Player, 100
  bannedObjectsLimit: 4
  poke:
  - self: true
    delay: 2                                     ### time until IceBlockers can start popping Ulvs
    parameter: p_iceblock_spawn_ulv_loop 1.3     ### time between chances to pop ulvs

# 4 players present
- prefab: IceBlocker
  type: create
  objects:
  - Dragon, 100
  - Player, 100
  objectsLimit: 5
  bannedObjects:
  - Player, 100
  bannedObjectsLimit: 5
  poke:
  - self: true
    delay: 1                                     ### time until IceBlockers can start popping Ulvs
    parameter: p_iceblock_spawn_ulv_loop 0.8     ### time between chances to pop ulvs

# 5+ players present
- prefab: IceBlocker
  type: create
  objects:
  - Dragon, 100
  - Player, 100
  objectsLimit: 6
  poke:
  - self: true
    delay: 0                                     ### time until IceBlockers can start popping Ulvs
    parameter: p_iceblock_spawn_ulv_loop 0.3     ### time between chances to pop ulvs

- prefab: IceBlocker
  type: poke, p_iceblock_spawn_ulv_loop
  poke:
  - self: true
    delay: <par1>
    parameter: p_iceblock_spawn_ulv_loop <par1>
  - self: true
    parameter: p_iceblock_spawn_ulv_spawn

- prefab: IceBlocker
  type: poke, p_iceblock_spawn_ulv_spawn
  weight: 0.1
  remove: true
  spawns:
  - Ulv, 0,0,0, 0,0,0, d_ulv_wakeup, 0.5
  - vfx_iceblocker_destroyed
  - sfx_ice_destroyed
  - fx_iceshard_hit
  - fx_HildirChest_Unlock, 0,0,0, 0,0,0, d_sfx_silent_creatures
  - vfx_Potion_stamina_medium
  triggerRules: true

- prefab: Ulv
  type: state, wakeup
  objects:
  - Dragon, 100
  spawns:
  - sfx_wolf_attack, 0,0,0, 0,0,0, d_ulv_howl_pitch

# Moder - extra attacks
- prefab: Dragon
  types:
  - state, attack_claw_left
  weight: 0.4
  poke:
  - self: true
    delay: 2.2
    parameter: p_extra_attack_moder_left

- prefab: Dragon
  types:
  - state, attack_claw_right
  weight: 0.4
  poke:
  - self: true
    delay: 2.2
    parameter: p_extra_attack_moder_right

- prefab: Dragon
  type: poke, p_extra_attack_moder_left
  objects:
  - Player, 12
  - creature, 12, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, attack_claw_right

- prefab: Dragon
  type: poke, p_extra_attack_moder_right
  objects:
  - Player, 12
  - creature, 12, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, attack_claw_left

# Moder taunt bursts all remaining IceBlockers for AE dmg & slow to any nearby players or tames
- prefab: Dragon
  types:
  - state, attack_taunt
  objects:
  - IceBlocker, 100    # only show FX if there's an IceBlocker to pop
  spawn: fx_DvergerMage_Mistile_attack, 0,5,2, 0,0,0, d_empty_data_creatures, 2.5
  poke:
  - prefab: IceBlocker
    maxDistance: 100
    delay: 3
    parameter: p_iceblock_burst_init

- prefab: IceBlocker
  type: poke, p_iceblock_burst_init
  poke:
  - self: true
    parameter: p_iceblock_burst_rndDly <randf_0_0.7>

- prefab: IceBlocker
  type: poke, p_iceblock_burst_rndDly
  poke:
  - self: true
    delay: <par1>
    parameter: p_iceblock_burst

- prefab: IceBlocker
  type: poke, p_iceblock_burst
  spawns:
  - vfx_iceblocker_destroyed
  - fx_DvergerMage_Mistile_attack
  - fx_DvergerMage_Mistile_die
  - sfx_troll_attack_hit
  remove: true
  poke:
  - prefab: Player
    maxDistance: 7
    parameter: p_iceblock_burst_calc <x> <z> 210+<vModerIceBlockerDmgRnd>
  - prefab: creature
    data: tamed_creatures
    maxDistance: 7
    parameter: p_iceblock_burst_calc <x> <z> 35+<vModerIceBlockerDmgRnd>

- prefab: Player, creature
  type: poke, p_iceblock_burst_calc
  data: d_force_away_calc_creatures
  injectData: true
  poke:
  - self: true
    delay: 0.1
    parameter: p_iceblock_burst_dmg <par3>

- prefab: Player, creature
  type: poke, p_iceblock_burst_dmg
  spawns:
  - fx_iceshard_hit
  objectRpc:
  - name: RPC_Damage
    1: hit, frost=<par1> dodge=true block=true status=SE_Savheim_Slowed force=60 dir=<float_f_force_x>,<float_f_force_z>,<y>

######
# Players or tames hit by frost breath cause an IceBlocker to spawn.
- prefab: vfx_Frost
  type: create
  objects:
  - Dragon, 100
  - vfx_dragon_coldbreath, 20
  poke:
  - prefab: Player
    maxDistance: 1
    limit: 1
    parameter: p_iceblock_spawn
  - prefab: creature
    data: tamed_creatures
    maxDistance: 1
    limit: 1
    parameter: p_iceblock_spawn

- prefab: Player, creature
  type: poke, p_iceblock_spawn
  spawns:
  - IceBlocker, 0,-1,0
  triggerRules: true

###################################################
# Yagluth
# move and turn faster
- prefab: GoblinKing
  type: create
  biomes: Meadows, Blackforest, Swamp, Ocean, Mountain, Plains, Mistlands, AshLands
  data: d_yagluth_ai

# Melee AOE shortened so a successful dodge lets you stay in melee
- prefab: aoe_nova
  type: create
  poke:
  - self: true
    delay: 1
    parameter: p_yagluth_melee_aoe_truncate

- prefab: aoe_nova
  type: poke, p_yagluth_melee_aoe_truncate
  remove: true

# Yagluth - extra attacks
- prefab: GoblinKing
  types:
  - state, nova
  weight: 0.35
  poke:
  - self: true
    delay: 4.5
    parameter: p_extra_attack_yagluth_nova

- prefab: GoblinKing
  type: poke, p_extra_attack_yagluth_nova
  objects:
  - Player, 12
  - creature, 12, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, nova

###
# meteors have a chance to spawn a variety of skeletal adds, based on number of players present
# 1 player present
- prefab: fx_goblinking_meteor_hit
  type: create
  weight: 0.1                                    ### SPAWN CHANCE PER METEOR
  objects:
  - GoblinKing, 100
  - Player, 100
  objectsLimit: 2
  bannedObjects:
  - Player, 100
  bannedObjectsLimit: 2
  poke:
  - self: true
    parameter: p_random_yagluth_meteor_spawn_max1

# 2 players present
- prefab: fx_goblinking_meteor_hit
  type: create
  weight: 0.1                                    ### SPAWN CHANCE PER METEOR
  objects:
  - GoblinKing, 100
  - Player, 100
  objectsLimit: 3
  bannedObjects:
  - Player, 100
  bannedObjectsLimit: 3
  poke:
  - self: true
    parameter: p_random_yagluth_meteor_spawn_max2

# 3 players present
- prefab: fx_goblinking_meteor_hit
  type: create
  weight: 0.15                                   ### SPAWN CHANCE PER METEOR
  objects:
  - GoblinKing, 100
  - Player, 100
  objectsLimit: 4
  bannedObjects:
  - Player, 100
  bannedObjectsLimit: 4
  poke:
  - self: true
    parameter: p_random_yagluth_meteor_spawn_max3

# 4 players present
- prefab: fx_goblinking_meteor_hit
  type: create
  weight: 0.2                                    ### SPAWN CHANCE PER METEOR
  objects:
  - GoblinKing, 100
  - Player, 100
  objectsLimit: 5
  bannedObjects:
  - Player, 100
  bannedObjectsLimit: 5
  poke:
  - self: true
    parameter: p_random_yagluth_meteor_spawn_max3

# 5+ players present
- prefab: fx_goblinking_meteor_hit
  type: create
  weight: 0.25                                   ### SPAWN CHANCE PER METEOR
  objects:
  - GoblinKing, 100
  - Player, 100
  objectsLimit: 6
  poke:
  - self: true
    parameter: p_random_yagluth_meteor_spawn_max3

###
# fire skeleton.  high damage.
- prefab: fx_goblinking_meteor_hit
  type: poke, p_random_yagluth_meteor_spawn_max1
  bannedObjects:
  - Skeleton_Hildir, 100, d_yagluth_add_fire
  bannedObjectsLimit: 1                          ### MAX SPAWN PER VARIANT, set by number of players present
  spawn: Skeleton_Hildir, 0,0,0, 0,0,0, d_yagluth_add_fire
  poke:
  - prefab: Skeleton_Hildir
    data: d_yagluth_add_fire
    limit: 1
    delay: 1                                     ### IMMUNITY TIME AFTER SPAWN
    parameter: p_yagluth_add_beam_loop

- prefab: fx_goblinking_meteor_hit
  type: poke, p_random_yagluth_meteor_spawn_max2
  bannedObjects:
  - Skeleton_Hildir, 100, d_yagluth_add_fire
  bannedObjectsLimit: 2                          ### MAX SPAWN PER VARIANT, set by number of players present
  spawn: Skeleton_Hildir, 0,0,0, 0,0,0, d_yagluth_add_fire
  poke:
  - prefab: Skeleton_Hildir
    data: d_yagluth_add_fire
    limit: 1
    delay: 1                                     ### IMMUNITY TIME AFTER SPAWN
    parameter: p_yagluth_add_beam_loop

- prefab: fx_goblinking_meteor_hit
  type: poke, p_random_yagluth_meteor_spawn_max3
  bannedObjects:
  - Skeleton_Hildir, 100, d_yagluth_add_fire
  bannedObjectsLimit: 3                          ### MAX SPAWN PER VARIANT, set by number of players present
  spawn: Skeleton_Hildir, 0,0,0, 0,0,0, d_yagluth_add_fire
  poke:
  - prefab: Skeleton_Hildir
    data: d_yagluth_add_fire
    limit: 1
    delay: 1                                     ### IMMUNITY TIME AFTER SPAWN
    parameter: p_yagluth_add_beam_loop

# frost skeleton.  medium damage, frost snares
- prefab: fx_goblinking_meteor_hit
  type: poke, p_random_yagluth_meteor_spawn_max1
  bannedObjects:
  - Skeleton, 100, d_yagluth_add_frost
  bannedObjectsLimit: 1                          ### MAX SPAWN PER VARIANT, set by number of players present
  spawn: Skeleton, 0,0,0, 0,0,0, d_yagluth_add_frost
  poke:
  - prefab: Skeleton
    data: d_yagluth_add_frost
    limit: 1
    delay: 1                                     ### IMMUNITY TIME AFTER SPAWN
    parameter: p_yagluth_add_beam_loop

- prefab: fx_goblinking_meteor_hit
  type: poke, p_random_yagluth_meteor_spawn_max2
  bannedObjects:
  - Skeleton, 100, d_yagluth_add_frost
  bannedObjectsLimit: 2                          ### MAX SPAWN PER VARIANT, set by number of players present
  spawn: Skeleton, 0,0,0, 0,0,0, d_yagluth_add_frost
  poke:
  - prefab: Skeleton
    data: d_yagluth_add_frost
    limit: 1
    delay: 1                                     ### IMMUNITY TIME AFTER SPAWN
    parameter: p_yagluth_add_beam_loop

- prefab: fx_goblinking_meteor_hit
  type: poke, p_random_yagluth_meteor_spawn_max3
  bannedObjects:
  - Skeleton, 100, d_yagluth_add_frost
  bannedObjectsLimit: 3                          ### MAX SPAWN PER VARIANT, set by number of players present
  spawn: Skeleton, 0,0,0, 0,0,0, d_yagluth_add_frost
  poke:
  - prefab: Skeleton
    data: d_yagluth_add_frost
    limit: 1
    delay: 1                                     ### IMMUNITY TIME AFTER SPAWN
    parameter: p_yagluth_add_beam_loop

# nature skeleton.  low damage, heals self and allies
- prefab: fx_goblinking_meteor_hit
  type: poke, p_random_yagluth_meteor_spawn_max1
  bannedObjects:
  - Skeleton_Poison, 100, d_yagluth_add_nature
  bannedObjectsLimit: 1                          ### MAX SPAWN PER VARIANT, set by number of players present
  spawn: Skeleton_Poison, 0,0,0, 0,0,0, d_yagluth_add_nature
  poke:
  - prefab: Skeleton_Poison
    data: d_yagluth_add_nature
    limit: 1
    delay: 1                                     ### IMMUNITY TIME AFTER SPAWN
    parameter: p_yagluth_add_beam_loop

- prefab: fx_goblinking_meteor_hit
  type: poke, p_random_yagluth_meteor_spawn_max2
  bannedObjects:
  - Skeleton_Poison, 100, d_yagluth_add_nature
  bannedObjectsLimit: 2                          ### MAX SPAWN PER VARIANT, set by number of players present
  spawn: Skeleton_Poison, 0,0,0, 0,0,0, d_yagluth_add_nature
  poke:
  - prefab: Skeleton_Poison
    data: d_yagluth_add_nature
    limit: 1
    delay: 1                                     ### IMMUNITY TIME AFTER SPAWN
    parameter: p_yagluth_add_beam_loop

- prefab: fx_goblinking_meteor_hit
  type: poke, p_random_yagluth_meteor_spawn_max3
  bannedObjects:
  - Skeleton_Poison, 100, d_yagluth_add_nature
  bannedObjectsLimit: 3                          ### MAX SPAWN PER VARIANT, set by number of players present
  spawn: Skeleton_Poison, 0,0,0, 0,0,0, d_yagluth_add_nature
  poke:
  - prefab: Skeleton_Poison
    data: d_yagluth_add_nature
    limit: 1
    delay: 1                                     ### IMMUNITY TIME AFTER SPAWN
    parameter: p_yagluth_add_beam_loop

### If adds get hit by beam, kill them and spawn boons to player
- prefab: Skeleton_Hildir, Skeleton, Skeleton_Poison
  type: poke, p_yagluth_add_beam_loop
  fallback: true
  poke:
  - self: true
    delay: 0.5
    parameter: p_yagluth_add_beam_loop

# fire boon = damage buff
- prefab: Skeleton_Hildir
  type: poke, p_yagluth_add_beam_loop
  objects:
  - projectile_beam, 3
  data: d_zero_health_creatures
  injectData: true
  spawns:
  - vfx_Potion_health_medium, 0,0,3, 0,0,0, d_empty_data_creatures, 0, true
  - vfx_Potion_health_medium, 0,0,6, 0,0,0, d_fx_remove_early, 0.2, true  # true to trigger early removal
  - vfx_Potion_health_medium, 0,0,9, 0,0,0, d_fx_remove_early, 0.4, true  # true to trigger early removal
  - vfx_Potion_health_medium, 0,0,6, 0,0,0, d_fx_remove_early, 1.2, true  # true to trigger early removal
  - vfx_Potion_health_medium, 0,0,9, 0,0,0, d_fx_remove_early, 1.4, true  # true to trigger early removal
  - sfx_Potion_frostresist_Start
  - fx_fireball_staff_explosion, 0,0,1.5
  - fx_siegebomb_explosion, 0,0,1.5
  - fx_HildirChest_Unlock, 0,0,0, 0,0,0, d_sfx_silent_creatures
  poke:
  - prefab: GoblinKing
    maxDistance: 100
    limit: 1
    parameter: p_yagluth_add_beam_hit_fire

# frost boon = speed boost
- prefab: Skeleton
  type: poke, p_yagluth_add_beam_loop
  objects:
  - projectile_beam, 3
  data: d_zero_health_creatures
  injectData: true
  spawns:
  - fx_Potion_frostresist, 0,0,3, 0,0,0, d_empty_data_creatures, 0, true
  - fx_Potion_frostresist, 0,0,6, 0,0,0, d_sfx_silent_creatures, 0.2, false
  - fx_Potion_frostresist, 0,0,9, 0,0,0, d_sfx_silent_creatures, 0.4, false
  - fx_Potion_frostresist, 0,0,6, 0,0,0, d_sfx_silent_creatures, 1.2, false
  - fx_Potion_frostresist, 0,0,9, 0,0,0, d_sfx_silent_creatures, 1.4, false
  - fx_fireball_staff_explosion, 0,0,1.5
  - fx_siegebomb_explosion, 0,0,1.5
  - fx_HildirChest_Unlock, 0,0,0, 0,0,0, d_sfx_silent_creatures
  poke:
  - prefab: GoblinKing
    maxDistance: 100
    limit: 1
    parameter: p_yagluth_add_beam_hit_frost

# nature boon = HoT
- prefab: Skeleton_Poison
  type: poke, p_yagluth_add_beam_loop
  objects:
  - projectile_beam, 3
  data: d_zero_health_creatures
  injectData: true
  spawns:
  - vfx_Potion_stamina_medium, 0,0,3, 0,0,0, d_empty_data_creatures, 0, true
  - vfx_Potion_stamina_medium, 0,0,6, 0,0,0, d_empty_data_creatures, 0.2, false
  - vfx_Potion_stamina_medium, 0,0,9, 0,0,0, d_empty_data_creatures, 0.4, false
  - vfx_Potion_stamina_medium, 0,0,6, 0,0,0, d_empty_data_creatures, 1.2, false
  - vfx_Potion_stamina_medium, 0,0,9, 0,0,0, d_empty_data_creatures, 1.4, false
  - sfx_Potion_frostresist_Start
  - fx_fireball_staff_explosion, 0,0,1.5
  - fx_siegebomb_explosion, 0,0,1.5
  - fx_HildirChest_Unlock, 0,0,0, 0,0,0, d_sfx_silent_creatures
  poke:
  - prefab: GoblinKing
    maxDistance: 100
    limit: 1
    parameter: p_yagluth_add_beam_hit_nature

# use yag's taunt animation as a grieving stagger effect
- prefab: GoblinKing
  type: poke, p_yagluth_add_beam_hit_fire
  data: d_yagluth_boon_ttl_fire_start
  injectData: true
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, taunt
  poke:
  - self: true
    delay: 12                                    ### FIRE BOON PUDDLE TTL
    parameter: p_yagluth_boon_ttl_fire_end

- prefab: GoblinKing
  type: poke, p_yagluth_add_beam_hit_frost
  data: d_yagluth_boon_ttl_frost_start
  injectData: true
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, taunt
  poke:
  - self: true
    delay: 12                                    ### FROST BOON PUDDLE TTL
    parameter: p_yagluth_boon_ttl_frost_end

- prefab: GoblinKing
  type: poke, p_yagluth_add_beam_hit_nature
  data: d_yagluth_boon_ttl_nature_start
  injectData: true
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, taunt
  poke:
  - self: true
    delay: 12                                    ### NATURE BOON PUDDLE TTL
    parameter: p_yagluth_boon_ttl_nature_end

- prefab: GoblinKing
  type: poke, p_yagluth_boon_ttl_fire_end
  data: d_yagluth_boon_ttl_fire_end
  injectData: true

- prefab: GoblinKing
  type: poke, p_yagluth_boon_ttl_frost_end
  data: d_yagluth_boon_ttl_frost_end
  injectData: true

- prefab: GoblinKing
  type: poke, p_yagluth_boon_ttl_nature_end
  data: d_yagluth_boon_ttl_nature_end
  injectData: true

# create boon puddles when wights killed by beams - Fire Boon Puddle
- prefab: vfx_Potion_health_medium
  type: create
  filter: int, i_fx_remove_early, 0
  objects:
  - GoblinKing, 100, d_yagluth_boon_ttl_fire_start    # controls ttl. see p_yagluth_boon_ttl_X_rst
  - fx_HildirChest_Unlock, 3                          # reduce accidental triggers
  spawns:
  - vfx_Potion_health_medium, 0,0,0, 0,0,0, d_empty_data_creatures, 3, true
  - fx_HildirChest_Unlock, 0,0,-3, 0,0,0, d_sfx_silent_creatures, 3
  poke:
  - prefab: Player
    limit: 5
    maxDistance: 3
    parameter: p_yagluth_boon_player_fire
  - prefab: Player
    limit: 5
    maxDistance: 3
    delay: 1.5   # final chance to get buff before potion vfx fades, plus quicker pokes as players run through
    parameter: p_yagluth_boon_player_fire
  - self: true
    parameter: p_yagluth_boon_vfx_fire_remove_loop

# clean up fire boon so it doesn't appear to last longer than intended
- prefab: vfx_Potion_health_medium
  type: create
  objects:
  - GoblinKing, 100, d_yagluth_boon_ttl_fire_end
  remove: true

- prefab: vfx_Potion_health_medium
  type: poke, p_yagluth_boon_vfx_fire_remove_loop
  poke:
  - self: true
    delay: 2
    parameter: p_yagluth_boon_vfx_fire_remove_loop
  - self: true
    parameter: p_yagluth_boon_vfx_fire_remove_attempt

- prefab: vfx_Potion_health_medium
  type: poke, p_yagluth_boon_vfx_fire_remove_attempt
  objects:
  - GoblinKing, 100, d_yagluth_boon_ttl_fire_end
  remove: true

# Frost Boon Puddle
- prefab: fx_Potion_frostresist
  type: create
  objects:
  - GoblinKing, 100, d_yagluth_boon_ttl_frost_start   # controls ttl. see p_yagluth_boon_ttl_X_rst
  - fx_HildirChest_Unlock, 3                          # reduce accidental triggers
  spawns:
  - fx_Potion_frostresist, 0,0,0, 0,0,0, d_sfx_silent_creatures, 1, false
  - fx_Potion_frostresist, 0,0,0, 0,0,0, d_sfx_silent_creatures, 2, false
  - fx_Potion_frostresist, 0,0,0, 0,0,0, d_sfx_silent_creatures, 3, true
  - fx_HildirChest_Unlock, 0,0,-3, 0,0,0, d_sfx_silent_creatures, 3
  poke:
  - prefab: Player
    limit: 5
    maxDistance: 3
    parameter: p_yagluth_boon_player_frost
  - prefab: Player
    limit: 5
    maxDistance: 3
    delay: 1.5   # final chance to get buff before potion vfx fades, plus quicker pokes as players run through
    parameter: p_yagluth_boon_player_frost

# Nature Boon Puddle
- prefab: vfx_Potion_stamina_medium
  type: create
  objects:
  - GoblinKing, 100, d_yagluth_boon_ttl_nature_start  # controls ttl. see p_yagluth_boon_ttl_X_rst
  - fx_HildirChest_Unlock, 3                          # reduce accidental triggers
  spawns:
  - vfx_Potion_stamina_medium, 0,0,0, 0,0,0, d_empty_data_creatures, 1, false
  - vfx_Potion_stamina_medium, 0,0,0, 0,0,0, d_empty_data_creatures, 2, false
  - vfx_Potion_stamina_medium, 0,0,0, 0,0,0, d_empty_data_creatures, 3, true
  - fx_HildirChest_Unlock, 0,0,-3, 0,0,0, d_sfx_silent_creatures, 3
  poke:
  - prefab: Player
    limit: 5
    maxDistance: 3
    parameter: p_yagluth_boon_player_nature
  - prefab: Player
    limit: 5
    maxDistance: 3
    delay: 1.5   # final chance to get buff before potion vfx fades, plus quicker pokes as players run through
    parameter: p_yagluth_boon_player_nature

# health potion vfx lasts way too long for what i'm trying to do, so shorten the ones that are just there for visual effect (vs. poke functionlity)!
# the spawns above are tagged with a custom data just to make sure we're only affecting the intended ones
- prefab: vfx_Potion_health_medium
  type: create
  filter: d_fx_remove_early   # filter
  remove: true
  removeDelay: 1.95

# apply boons to players who stand near boon puddle for up to 3 seconds
- prefab: Player
  type: poke, p_yagluth_boon_player_fire
  objectRpc:
  - name: RPC_AddStatusEffect
    1: hash, SE_Savheim_Yagluth_Boon_Fire
    2: bool, true
    3: int, 1
    4: float, 1

- prefab: Player
  type: poke, p_yagluth_boon_player_frost
  objectRpc:
  - name: RPC_AddStatusEffect
    1: hash, SE_Savheim_Yagluth_Boon_Frost
    2: bool, true
    3: int, 1
    4: float, 1

- prefab: Player
  type: poke, p_yagluth_boon_player_nature
  objectRpc:
  - name: RPC_AddStatusEffect
    1: hash, SE_Savheim_Yagluth_Boon_Nature
    2: bool, true
    3: int, 1
    4: float, 1

###################################################
# The Queen
# faster turn speed
- prefab: SeekerQueen
  type: create
  biomes: Meadows, Blackforest, Swamp, Ocean, Mountain, Plains, Mistlands, AshLands
  data: d_queen_ai

# Queen - extra attacks.  slash1: upper-left leg.  slash2:upper-right leg.  slash3: lower-left leg.
- prefab: SeekerQueen
  type: state, attack_pierce                     # all 4 legs pierce downward
  poke:
  - self: true
    delay: 1.6
    parameter: p_extra_attack_queen_p

- prefab: SeekerQueen
  types:
  - state, attack_slash1                         # upper-left leg slash
  poke:
  - self: true
    delay: 1.6
    parameter: p_extra_attack_queen_ul

- prefab: SeekerQueen
  types:
  - state, attack_slash2                         # upper-right leg slash
  poke:
  - self: true
    delay: 1.6
    parameter: p_extra_attack_queen_ur

- prefab: SeekerQueen
  types:
  - state, attack_slash3                         # lower-left leg slash.  CAN BE PARRIED!
  poke:
  - self: true                                   # special case - no delay here.  see below.
    parameter: p_extra_attack_queen_ll <randf_0.3_0.5>     ### ANIMATION STUTTER DELAY

# extra attack results - pierce:  100% chance of follow up.
- prefab: SeekerQueen
  type: poke, p_extra_attack_queen_p
  weight: 0.1
  objects:
  - Player, 8                                # check range!  LSDJFLKJAEOFWILJIAESJF
  - creature, 8, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, attack_pierce

- prefab: SeekerQueen
  type: poke, p_extra_attack_queen_p
  weight: 0.3
  objects:
  - Player, 12
  - creature, 12, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, attack_slash1

- prefab: SeekerQueen
  type: poke, p_extra_attack_queen_p
  weight: 0.3
  objects:
  - Player, 12
  - creature, 12, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, attack_slash2

- prefab: SeekerQueen
  type: poke, p_extra_attack_queen_p
  weight: 0.3
  objects:
  - Player, 12
  - creature, 12, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, attack_slash3

# extra attack results - slash1:  40% chance of follow up.
- prefab: SeekerQueen
  type: poke, p_extra_attack_queen_ul
  weight: 0.4
  objects:
  - Player, 12
  - creature, 12, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, attack_slash2

# extra attack results - slash2:  50% chance of follow up.
- prefab: SeekerQueen
  type: poke, p_extra_attack_queen_ur
  weight: 0.25
  objects:
  - Player, 12
  - creature, 12, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, attack_slash1

- prefab: SeekerQueen
  type: poke, p_extra_attack_queen_ur
  weight: 0.25
  objects:
  - Player, 12
  - creature, 12, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, attack_slash3

# extra attack results - slash3
# CAN BE PARRIED!
# animation stutter and fx to queue player
# lower damage on this swing only
# no follow up attack
- prefab: SeekerQueen
  type: poke, p_extra_attack_queen_ll
  poke:
  - self: true
    delay: <par1>
    parameter: p_queen_slash3_stutter

- prefab: SeekerQueen
  type: poke, p_queen_slash3_stutter
  data: d_queen_lower_damage
  injectData: true
  spawns:
  - sfx_tick_attack_drain
  - sfx_battleaxe_hit, d_sfx_queen_crunch_pitch
  - vfx_draugrpile_hit, -2,0,3
  - sfx_HiveQueen_rush, d_sfx_queen_scream_pitch, 0.15
  - sfx_fallenvalkyrie_alert, d_sfx_queen_scream_pitch, 0.15
  objectRpc:
  - name: RPC_FreezeFrame
    target: all
    1: float, 0.3
  poke:
  - self: true
    delay: 2
    parameter: p_queen_normal_damage
  - prefab: sfx_battleaxe_hit
    data: d_sfx_queen_crunch_pitch
    delay: 2
    parameter: p_queen_sfx_battleaxe_hit_truncate

- prefab: SeekerQueen
  type: poke, p_queen_normal_damage
  data: d_queen_normal_damage
  injectData: true

- prefab: sfx_battleaxe_hit
  type: poke, p_queen_sfx_battleaxe_hit_truncate
  remove: true

# stagger queen and adds if her weakened swing is parried - hive mind!
- prefab: vfx_perfectblock
  type: create
  objects:
  - SeekerQueen, 12
  - sfx_battleaxe_hit, 12, d_sfx_queen_crunch_pitch
  poke:
  - prefab: SeekerQueen
    limit: 1
    parameter: p_queen_stagger <vec>
  - prefab: Seeker
    maxDistance: 100
    parameter: p_queen_stagger <vec>
  - prefab: SeekerBrood
    maxDistance: 100
    parameter: p_queen_stagger <vec>
  - prefab: SeekerBrute
    maxDistance: 100
    parameter: p_queen_stagger <vec>

# SeekerBrute don't spawn from Queen, but in case some whacko makes a Deep North encounter or something...
- prefab: SeekerQueen, Seeker, SeekerBrood, SeekerBrute
  type: poke, p_queen_stagger
  spawns:
  - sfx_HiveQueen_rush, d_sfx_queen_scream_pitch
  - sfx_fallenvalkyrie_alert, d_sfx_queen_scream_pitch
  objectRpc:
  - name: RPC_Stagger
    1: vec, <par1>
  poke:
  - self: true
    delay: 3
    parameter: p_queen_stagger_extend <par1>

# adds get staggered much longer
- prefab: Seeker, SeekerBrood, SeekerBrute
  type: poke, p_queen_stagger_extend
  objectRpc:
  - name: RPC_Stagger
    1: vec, <par1>

###
# Fewer adds for solo and duo players in Mistlands encounter only
# 1 player present
- prefab: Seeker, SeekerBrood
  type: create
  biomes: Mistlands
  objects:
  - SeekerQueen, 100
  - Player, 100
  objectsLimit: 2
  bannedObjects:
  - Player, 100
  bannedObjectsLimit: 2
  weight: 0.5
  remove: true

# 2 players present
- prefab: Seeker, SeekerBrood
  type: create
  biomes: Mistlands
  objects:
  - SeekerQueen, 100
  - Player, 100
  objectsLimit: 3
  bannedObjects:
  - Player, 100
  bannedObjectsLimit: 3
  weight: 0.25
  remove: true

###################################################
# Fader
# faster
- prefab: Fader
  type: create
  biomes: Meadows, Blackforest, Swamp, Ocean, Mountain, Plains, Mistlands, AshLands
  data: d_fader_ai

# Fader - extra attacks.  attack_clawr, attack_clawl, attack_bite, attack_spin
- prefab: Fader
  type: state, attack_clawl
  poke:
  - self: true
    delay: 2
    parameter: p_extra_attack_fader_clawl

- prefab: Fader
  type: state, attack_clawr
  poke:
  - self: true
    delay: 2
    parameter: p_extra_attack_fader_clawr

# extra attack reactions - clawl
- prefab: Fader
  type: poke, p_extra_attack_fader_clawl
  weight: 0.2
  objects:
  - Player, 12
  - creature, 12, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, attack_bite

# extra attack reactions - clawr
- prefab: Fader
  type: poke, p_extra_attack_fader_clawr
  weight: 0.2
  objects:
  - Player, 12
  - creature, 12, tamed_creatures
  objectsLimit: 1
  objectRpc:
  - name: SetTrigger
    target: all
    1: name, attack_bite
